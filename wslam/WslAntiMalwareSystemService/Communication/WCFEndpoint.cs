using System;
using System.ServiceModel;
using WslAntiMalware.Tracing;

namespace WslAntiMalware.Communication
{
    class WCFEndpoint
    {
    }

    [ServiceContract(Namespace = "http://Microsoft.ServiceModel.Samples", CallbackContract = typeof(ISystemServiceMessages), SessionMode = SessionMode.Required)]
    public interface IWslAntiMalwareSystemServiceEndpoint
    {
        [OperationContract]
        void StartMonitoring();
        [OperationContract]
        void StopMonitoring();
    }

    public interface ISystemServiceMessages
    {
        [OperationContract(IsOneWay = false)]
        void LogMessage(string str);    
    }

    public class WslAntiMalwareSystemServiceEndpoint : IWslAntiMalwareSystemServiceEndpoint
    {
        WslAntiMalwareSystemServiceEndpoint()
        {
            Console.WriteLine("new service");
        }

        public void StartMonitoring()
        {
            Logger.Instance.LogMessage("Received Start Monitoring request");
        }

        public void StopMonitoring()
        {
            Logger.Instance.LogMessage("Received Stop Monitoring request");
        }

        ISystemServiceMessages Callback
        {
            get
            {
                return OperationContext.Current.GetCallbackChannel<ISystemServiceMessages>();
            }
        }
    }
}
