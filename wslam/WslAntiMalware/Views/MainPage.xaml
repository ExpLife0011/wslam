<Page
    x:Class="WslAntiMalware.Presentation.MainPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:WslAntiMalware.Presentation"
    xmlns:vm="using:WslAntiMalware.ViewModel"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:converters="using:WslAntiMalware.Converters"
    mc:Ignorable="d">

    <Page.Resources>
        <converters:DetectionTextConverter x:Key="DetectionTextConverter"/>
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="auto"/>
        </Grid.RowDefinitions>
        <Pivot x:Name="rootPivot">
            <PivotItem Name="piSettings">
                <PivotItem.Header>
                    <local:TabbedHeader Label="Settings" Glyph="&#xE713;"/>
                </PivotItem.Header>
                <StackPanel>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Top" HorizontalAlignment="Left">
                        <ToggleSwitch x:Name="tsMonitoring" IsOn="False" Header="Monitoring control"  OffContent="Not Monitoring" OnContent="Monitoring" Toggled="ToggleMonitoringState"/>
                        <ProgressRing x:Name="prMonitoring" IsActive="{Binding IsMonitoringProgressRingVisible, Source={StaticResource vmSettings}, Mode=TwoWay}" HorizontalAlignment="LEft" Width="130"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Top" HorizontalAlignment="Left">
                        <ToggleSwitch x:Name="tsAllowElevatedWsl" IsOn="False" Header="Elevated WSL Policy"  OffContent="Deny" OnContent="Allow" Toggled="ToggleElevatedWslPolicy"/>
                        <ProgressRing x:Name="prAllowElevatedWsl" IsActive="{Binding IsWslPolicyProgressRingVisibile, Source={StaticResource vmSettings}, Mode=TwoWay}" HorizontalAlignment="Left" Width="130"/>
                    </StackPanel>
                </StackPanel>
            </PivotItem>
            <PivotItem Name="piNotifications">
                <PivotItem.Header>
                    <local:TabbedHeader Label="Notifications" Glyph="&#xE7E7;"/>
                </PivotItem.Header>
                <ListView
                        ItemsSource="{Binding Detections, Source={StaticResource vmMainPage}}"
                        KeyUp="RemoveDetectionItem"
                        >
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="auto"/>
                                    <RowDefinition Height="auto"/>
                                </Grid.RowDefinitions>
                                <TextBlock Text="An application was detected" Grid.Row="0"/>
                                <Frame Grid.Row="1" KeyDown="RemoveDetectionItem" Tag="{Binding UID}">
                                    <TextBlock Text="{Binding DisplayText}"/>
                                </Frame>
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </PivotItem>
            <PivotItem Name="piLogs">
                <PivotItem.Header>
                    <local:TabbedHeader Label="Logs" Glyph="&#xF0E3;"/>
                </PivotItem.Header>
                <ListView
                        ItemsSource="{Binding Messages, Source={StaticResource vmMainPage}}"
                        >
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <Grid>
                                <Grid.Resources>
                                    <converters:SeverityToColorConverter x:Key="SeverityToColorConverter"/>
                                </Grid.Resources>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="auto"/>
                                    <RowDefinition Height="auto"/>
                                </Grid.RowDefinitions>
                                <StackPanel Orientation="Horizontal">
                                    <FontIcon HorizontalAlignment="Center" Margin="0,12,0,0" Glyph="&#xE783;" Foreground="{Binding Severity, Converter={StaticResource SeverityToColorConverter}}"/>
                                    <TextBlock Text="{Binding Log}"/>
                                </StackPanel>
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </PivotItem>
        </Pivot>
    </Grid>
</Page>
